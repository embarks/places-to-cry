# Places to Cry

- [Places to Cry](#places-to-cry)
  - [Starting TypeScript project from scratch](#starting-typescript-project-from-scratch)
    - [Background & Requirements](#background--requirements)
      - [TypeScript & integrated into VSCode (IDE)](#typescript--integrated-into-vscode-ide)
      - [GraphQL Endpoint](#graphql-endpoint)

A boutique TypeScript package repository for an Apollo Lambda Server. üíÖ Contains the GraphQL schema for the Places to Cry application. Places to Cry is a simple application

## Starting TypeScript project from scratch

- [x] Open a README.md and make your first commit
- [x] find out what your dependencies are (these map nicely to your `node_modules`)
- [x] get tsconfig for builds (dependent on infrastructure)
- [x] set up tslint for hints
- [x] use `serverless` for dealing with development vs production environments

### Background & Requirements

This was not understandable until I read documentation and understood how to use the following the following tools.

- knex (ORM)
- dotenv (config)
- lambda (AWS infrastructure)
- pg/PostgreSQL (Persistence layer)
- GraphQL (Type Definitions and API)
- Apollo Server (GraphQL Server)
- TypeScript (transpiler)
- Serverless (configured for AWS Lambda deploy and local testing)
- Docker (configured for local testing)

#### TypeScript & integrated into VSCode (IDE)

- Write a `tslint.json`
- TSLint Plugin via VSCode
- `"extends": [ "tslint-config-airbnb" ]`
- also included, because the type-defs are generated by code:

```
"linterOptions": {
    "exclude": [
      "src/graphql/*generated.ts"
    ]
}
```

- The `tsconfig.json` is extended from the example shown for the `serverless-plugin-typescript`. I [inspected the codes](https://github.com/prisma-labs/serverless-plugin-typescript/blob/master/src/index.ts#L137) üîé to find how the tsconfig was used by the plugin and to figure out what the plugin does. The plugin's main file has hooks and calls a few methods for each hook. The hooks correspond with the Lambda lifecycle. The `compileTs` method uses this file.

#### GraphQL Endpoint

**Technical Requirements**

- Must run on AWS
  - Using Amazon RDS for "simplicity" and persistence.
  - Running the same version of the RDS should be fine locally with Docker.
- Must be serverless
  - I don't want to pay for running a server all the time.
  - I'll have to pay for Amazon RDS already, see above.
- Must have a GraphQL API
  - I want TypeScript so I don't have to fuss with JavaScript objects and `console.log` everything.
  - So, I want TypeScript types generated from GraphQL so I can think about my user experience first.
- [nice-to-have] pushes to the `master` branch automatically deploy to lambda

After:

- reading [about graphql lambdas](https://www.serverless.com/blog/running-scalable-reliable-graphql-endpoint-with-serverless)
- and [looking at this serverless graphql example](https://github.com/serverless/serverless-graphql)
- and [this apollo lambda typescript example](https://github.com/serverless/examples/tree/master/aws-node-typescript-apollo-lambda)
- and [checking out codegen](https://github.com/dotansimha/graphql-code-generator/)
- and seeing the beauty of [serverless-plugin-typescript](https://www.serverless.com/plugins/serverless-plugin-typescript)
- and finding [this article that contained the exact architecture I wanted, thanks Projekt202!](https://www.projekt202.com/blog/2020/create-an-end-to-end-serverless-app)

I figured out this repo should contain:

- [x] local connection details and a dockerfile for spinning up a local database for testing/dev

  - This is available via `.env.development` and `docker-compose.yml`
  - Both `.env.development` and `docker-compose.yml` are named based on automatic functions of their respective configuration tools:
    - [serverless-dotenv-plugin](https://www.serverless.com/plugins/serverless-dotenv-plugin) is a plugin that allows access to environment variables based on `NODE_ENV` for anything running in the lambda function (i.e. the Apollo Lambda Server).
    - `docker-compose.yml` is the default configuration file when running the development `db:*` commands.

- [x] graphql schema
  - `src/graphql/schema.ts` is the source of truth for the type definitions which will hopefully make this package more dependable and easy to develop.
- [x] type definitions
  - I automagically create the type definitions for my graphql types and resolvers with the `@graphql-codegen` libraries. Remember to thank them!
- [x] codegen config to convert graphql schema to type definitions
  - `codegen.yml` is a default configuration file and is used by the script `codegen`. It's really cool! `codegen.yml` will be updated as I become more comfortable with the tool.
- [ ] ~~serverless config to deploy an aws appsync~~
  - not going to do this, going to set up API Gateway myself. We'll go down that rabbit hole later but right now we're overwhelmed with docker, codegen, apollo, lambda and haven't even run it all locally yet so resist, bun, resist. üï≥üêá
- [ ] logic to fetch connection details to the AWS "production" RDS database
- [ ] resolvers that talk to the database
  - at this point I become incredibly thankful for typescript
- [ ] some plan for authenticating with captcha - will probably have to check a captcha response via https from the lambda
